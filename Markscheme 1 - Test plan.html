<HTML>
<head>
  <title>CO3509 Assignment 1 - Grade estimator</title>
  <link rel="stylesheet" type="text/css" href="https://martinbateman.github.io/style.css"/>
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script id="odauth" src="https://martinbateman.github.io/odauth.js"></script>
  
  <link rel="icon" href="https://d.sfx-df.ms/images/favicon.ico" type="image/x-icon">
  <link rel="mask-icon" href="https://d.sfx-df.ms/images/mask_icon.svg" color="#094AB2">
<script>
    function signInToOneDrive()
    {
      var appInfo = {
        "clientId": "da55778d-4c93-4a5d-9ac9-7e3d95c531ef",
        "redirectUri": "https://martinbateman.github.io/callback.html",
        "scopes": "files.readwrite.all",
        "authServiceUri": "https://login.microsoftonline.com/common/oauth2/v2.0/authorize"
      };
      provideAppInfo(appInfo);

      var baseUrl = getQueryVariable("baseUrl")
      msGraphApiRoot = (baseUrl) ? baseUrl : "https://graph.microsoft.com/v1.0/me";

      challengeForAuth();

      saveToCookie( { "apiRoot": msGraphApiRoot, "signedin": true } );
      return false;
    }

    function showCustomLoginButton(show)
    {
      var loginButton = document.getElementById("od-login");
      loginButton.style.display = show ? "block" : "none";

      var logoutButton = document.getElementById("od-logoff");
      logoutButton.style.display = show ? "none" : "block";
    }
    function saveToCookie(obj)
    {
      var expiration = new Date();
      expiration.setTime(expiration.getTime() + 3600 * 1000);
      var data = JSON.stringify(obj);
      var cookie = "odexplorer=" + data +"; path=/; expires=" + expiration.toUTCString();

      if (document.location.protocol.toLowerCase() == "https") {
        cookie = cookie + ";secure";
      }
      document.cookie = cookie;
    }
    function loadFromCookie()
    {
      var cookies = document.cookie;
      var name = "odexplorer=";
      var start = cookies.indexOf(name);
      if (start >= 0) {
        start += name.length;
        var end = cookies.indexOf(';', start);
        if (end < 0) {
          end = cookies.length;
        }
        else {
          postCookie = cookies.substring(end);
        }

        var value = cookies.substring(start, end);
        return JSON.parse(value);
      }
    return "";
    }
    function signOut()
    {
      logoutOfAuth();
      saveToCookie( { "apiRoot": msGraphApiRoot, "signedin": false } );
      $('#od-breadcrumb').empty();
      $('#od-items').empty();
      $('#od-json').empty();
      location.reload();
      clearInterval ();
    }
    function getQueryVariable(variable)
    {
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
     }

  var globalToken = "";
  var moduleCode = "CO3509";
  var assignmentNumber = "1";
  var saved = 1;
  var itemID = "";
  var maxX = 0;
  var maxX = 0;
  var settingDir = "appData";
  var fileName = "/" + settingDir + "/" + moduleCode + "-assignment-" + assignmentNumber + ".json"; 
  var pageTitle = "CO3509 Assignment 1 - Grade estimator";
  </script>
</head>
<BODY>
 <div id="od-site">
    <div id="od-commands">
      <div id="od-login" style="display: hidden">
        <a href="#" onclick="signInToOneDrive()">Sign in to OneDrive</a>&nbsp;&nbsp;
      </div>
      <div id="od-logoff" style="display: hidden">
        <a href="#" onclick="signOut()">Sign Out</a>
      </div>
    </div>
    <div id="od-title">CO3509 Assignment 1 - Grade estimator</div>
  </div>

  <div id="od-loading"></div>
  <div id="od-breadcrumb"></div>
  <div id="od-content">
<P>
This allows you to estimate your mark based on which critria you have completed. You should note that you are
not guaranteed to get the mark you work out using this tool.
</P>
<p>
This page is experimental. There are probably bugs or at least weird things. If you find a bug or a weird thing could you let me know.
</p>
<TABLE BORDER=1>
<TR>
  <TD></TD>
  <td>Fail(20)</td>
  <td>Pass(40)</td>
  <td>2.ii(50)</td>
  <td>2.i(60)</td>
  <td>1(70)</td>
  <td>1+(80)</td>

</TR>
<TR>
  <TD>Information (15)<br> Information Integration</TD>
  
  <TD ID="0-0" onclick="javascript:clicked(0, 0)">References of no relevance to the assignment.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 20)/ 80 * 100;
var target = document.getElementById ("0-0");
target.setAttribute ("name", worth);
maxX = 0;
maxY = 0;
</script>

  
  <TD ID="1-0" onclick="javascript:clicked(1, 0)">Majority of references cite technologies.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 40)/ 80 * 100;
var target = document.getElementById ("1-0");
target.setAttribute ("name", worth);
maxX = 1;
maxY = 0;
</script>

  
  <TD ID="2-0" onclick="javascript:clicked(2, 0)">Uses references to support investigation.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 50)/ 80 * 100;
var target = document.getElementById ("2-0");
target.setAttribute ("name", worth);
maxX = 2;
maxY = 0;
</script>

  
  <TD ID="3-0" onclick="javascript:clicked(3, 0)">Uses relevant references to support investigation.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 60)/ 80 * 100;
var target = document.getElementById ("3-0");
target.setAttribute ("name", worth);
maxX = 3;
maxY = 0;
</script>

  
  <TD ID="4-0" onclick="javascript:clicked(4, 0)">Uses references to support discussion</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 70)/ 80 * 100;
var target = document.getElementById ("4-0");
target.setAttribute ("name", worth);
maxX = 4;
maxY = 0;
</script>

  
  <TD ID="5-0" onclick="javascript:clicked(5, 0)">Uses references to support arguments.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 80)/ 80 * 100;
var target = document.getElementById ("5-0");
target.setAttribute ("name", worth);
maxX = 5;
maxY = 0;
</script>

  
</TR>
<TR>
  <TD>Research (15)<br> Research skills. Sources of extra information to support your testing.</TD>
  
  <TD ID="0-1" onclick="javascript:clicked(0, 1)">Fewer than 4 references.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 20)/ 80 * 100;
var target = document.getElementById ("0-1");
target.setAttribute ("name", worth);
maxX = 0;
maxY = 1;
</script>

  
  <TD ID="1-1" onclick="javascript:clicked(1, 1)">Four quality references. Only uses web references when there is no alternative.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 40)/ 80 * 100;
var target = document.getElementById ("1-1");
target.setAttribute ("name", worth);
maxX = 1;
maxY = 1;
</script>

  
  <TD ID="2-1" onclick="javascript:clicked(2, 1)">Six quality references. All information is included.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 50)/ 80 * 100;
var target = document.getElementById ("2-1");
target.setAttribute ("name", worth);
maxX = 2;
maxY = 1;
</script>

  
  <TD ID="3-1" onclick="javascript:clicked(3, 1)">Eight quality references.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 60)/ 80 * 100;
var target = document.getElementById ("3-1");
target.setAttribute ("name", worth);
maxX = 3;
maxY = 1;
</script>

  
  <TD ID="4-1" onclick="javascript:clicked(4, 1)">Ten quality references.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 70)/ 80 * 100;
var target = document.getElementById ("4-1");
target.setAttribute ("name", worth);
maxX = 4;
maxY = 1;
</script>

  
  <TD ID="5-1" onclick="javascript:clicked(5, 1)">Twelve quality references.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 80)/ 80 * 100;
var target = document.getElementById ("5-1");
target.setAttribute ("name", worth);
maxX = 5;
maxY = 1;
</script>

  
</TR>
<TR>
  <TD>Test plan (30)<br> How well your testing covers the aspects of the system.</TD>
  
  <TD ID="0-2" onclick="javascript:clicked(0, 2)">Tests are superficial. Only measuring metrics such as RTT, throughput, packet loss or jitter.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((30/100) * 20)/ 80 * 100;
var target = document.getElementById ("0-2");
target.setAttribute ("name", worth);
maxX = 0;
maxY = 2;
</script>

  
  <TD ID="1-2" onclick="javascript:clicked(1, 2)">Poor test plan. Aspects of testing are unclear. Criteria are not clearly defined. No idea what a pass/fail is.

Covers one aspect of the system.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((30/100) * 40)/ 80 * 100;
var target = document.getElementById ("1-2");
target.setAttribute ("name", worth);
maxX = 1;
maxY = 2;
</script>

  
  <TD ID="2-2" onclick="javascript:clicked(2, 2)">Test are given. Covers a reasonable  range of the system with details on the pass/fail criteria and reasoning behind each test. Or covers a wide range of the system but with few detail on each test.

No tools or test procedures given.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((30/100) * 50)/ 80 * 100;
var target = document.getElementById ("2-2");
target.setAttribute ("name", worth);
maxX = 2;
maxY = 2;
</script>

  
  <TD ID="3-2" onclick="javascript:clicked(3, 2)">Defined tests. Test cover a reasonable amount of the system. Some tests give sensible pass/fail criteria. Test procedures given - may or may not be the best method.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((30/100) * 60)/ 80 * 100;
var target = document.getElementById ("3-2");
target.setAttribute ("name", worth);
maxX = 3;
maxY = 2;
</script>

  
  <TD ID="4-2" onclick="javascript:clicked(4, 2)">Defined test criteria. Covers a wide range aspects needed to be tested. Most tests give a sensible pass/fail criteria, reasoning for the criteria and a severity rating, Test procedure given - sensible choices made.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((30/100) * 70)/ 80 * 100;
var target = document.getElementById ("4-2");
target.setAttribute ("name", worth);
maxX = 4;
maxY = 2;
</script>

  
  <TD ID="5-2" onclick="javascript:clicked(5, 2)">Clearly defined test criteria. Covers a all aspects needed to be tested. All tests give a sensible pass/fail criteria, reasoning for the criteria and a severity rating, Test procedure given, excellent choice of tools.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((30/100) * 80)/ 80 * 100;
var target = document.getElementById ("5-2");
target.setAttribute ("name", worth);
maxX = 5;
maxY = 2;
</script>

  
</TR>
<TR>
  <TD>Execution (25)<br> Execution of the test plan on the network.</TD>
  
  <TD ID="0-3" onclick="javascript:clicked(0, 3)">No testing</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((25/100) * 20)/ 80 * 100;
var target = document.getElementById ("0-3");
target.setAttribute ("name", worth);
maxX = 0;
maxY = 3;
</script>

  
  <TD ID="1-3" onclick="javascript:clicked(1, 3)">Slight amount of testing - basic testing run.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((25/100) * 40)/ 80 * 100;
var target = document.getElementById ("1-3");
target.setAttribute ("name", worth);
maxX = 1;
maxY = 3;
</script>

  
  <TD ID="2-3" onclick="javascript:clicked(2, 3)">Quarter of the tests performed.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((25/100) * 50)/ 80 * 100;
var target = document.getElementById ("2-3");
target.setAttribute ("name", worth);
maxX = 2;
maxY = 3;
</script>

  
  <TD ID="3-3" onclick="javascript:clicked(3, 3)">Half of the tests performed.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((25/100) * 60)/ 80 * 100;
var target = document.getElementById ("3-3");
target.setAttribute ("name", worth);
maxX = 3;
maxY = 3;
</script>

  
  <TD ID="4-3" onclick="javascript:clicked(4, 3)">Most tests performed.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((25/100) * 70)/ 80 * 100;
var target = document.getElementById ("4-3");
target.setAttribute ("name", worth);
maxX = 4;
maxY = 3;
</script>

  
  <TD ID="5-3" onclick="javascript:clicked(5, 3)">All test performed.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((25/100) * 80)/ 80 * 100;
var target = document.getElementById ("5-3");
target.setAttribute ("name", worth);
maxX = 5;
maxY = 3;
</script>

  
</TR>
<TR>
  <TD>Presentation (15)<br> </TD>
  
  <TD ID="0-4" onclick="javascript:clicked(0, 4)">Lots of spelling and grammatical mistakes. Trouble understanding sentences.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 20)/ 80 * 100;
var target = document.getElementById ("0-4");
target.setAttribute ("name", worth);
maxX = 0;
maxY = 4;
</script>

  
  <TD ID="1-4" onclick="javascript:clicked(1, 4)">Some spelling and grammatical mistakes.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 40)/ 80 * 100;
var target = document.getElementById ("1-4");
target.setAttribute ("name", worth);
maxX = 1;
maxY = 4;
</script>

  
  <TD ID="2-4" onclick="javascript:clicked(2, 4)">Few spelling or grammatical mistakes. All diagrams have captions.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 50)/ 80 * 100;
var target = document.getElementById ("2-4");
target.setAttribute ("name", worth);
maxX = 2;
maxY = 4;
</script>

  
  <TD ID="3-4" onclick="javascript:clicked(3, 4)">Few spelling or grammatical mistakes. Diagrams are clear and understandable.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 60)/ 80 * 100;
var target = document.getElementById ("3-4");
target.setAttribute ("name", worth);
maxX = 3;
maxY = 4;
</script>

  
  <TD ID="4-4" onclick="javascript:clicked(4, 4)">No spelling or grammar errors.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 70)/ 80 * 100;
var target = document.getElementById ("4-4");
target.setAttribute ("name", worth);
maxX = 4;
maxY = 4;
</script>

  
  <TD ID="5-4" onclick="javascript:clicked(5, 4)">Concise and well structured. With the word limit for the assignment. 

No spelling or grammar errors.

Publishable quality.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((15/100) * 80)/ 80 * 100;
var target = document.getElementById ("5-4");
target.setAttribute ("name", worth);
maxX = 5;
maxY = 4;
</script>

  
</TR>

</TABLE>
<BR/>
<div style="display: inline-block">Estimated Total: </div><div style="display: inline-block" id="total">0</div>

<script>

var total = 0;

function gradeMap (mark){

  var allowedGrades = [0, 10, 25, 30, 35, 42, 45, 48, 52, 55, 58, 62, 65, 68, 74, 81, 89, 96, 100];


  bestFit = 0;
  bestDistance = 100;
  for (i =0; i < allowedGrades.length; i ++) {
    var distance = Math.abs (mark - allowedGrades[i]);

    if (distance < bestDistance) {
      bestFit = i;
      bestDistance = distance;
    }
  }
  return (""+allowedGrades[bestFit]);
}

function clicked (cellIDX, cellIDY){

var x = 0;
var found = true;
// remove coloured backgrounds
while (found == true){
    var parent = document.getElementById (x+"-"+cellIDY);
    
    if (parent != null) {
      if (x != cellIDX) { // skip the cell that was clicked
                          // so we know if the user has deselected an option
        if (parent.getAttribute ("style") == "background-color: orange") {
          parent.setAttribute ("style", "background-color: white");
          total = total - Math.round(Number(parent.getAttribute ("name")));
        }
      }
    x = x +1;    
  } else {
    found = false;
  }
  if (globalToken != ""){
    saved = 0;
    document.getElementById("od-title").innerHTML = pageTitle + " (not saved)";
  }
}

// set/remove colour background
var parent = document.getElementById (cellIDX+"-"+cellIDY);
if (parent.getAttribute ("style") == "background-color: orange") {
  total = total - Math.round (Number(parent.getAttribute ("name")));
  parent.setAttribute ("style", "background-color: white");
} else {
  parent.setAttribute ("style", "background-color: orange");

  total = total + Math.round(Number(parent.getAttribute ("name")));
}
document.getElementById("total").innerHTML = gradeMap (total);
//total;
}

</script>


  </div>
  <script>
    var baseUrl = getQueryVariable("baseUrl")
    msGraphApiRoot = (baseUrl) ? baseUrl : "https://graph.microsoft.com/v1.0/me";

    var data = loadFromCookie();
    if (data)
    {
      if (!baseUrl)
        msGraphApiRoot = data.apiRoot;
      showCustomLoginButton(!data.signedin)
    }

    $(document).on({
      ajaxStart: function() {$('body').addClass('loading');},
      ajaxStop:  function() {$('body').removeClass('loading');}
    });

    function uploadItem (){
          var contentURL = msGraphApiRoot + "/drive/items/" + itemID + "/content";

          var assignmentData = Array(maxX+1);
          for (var i = 0; i <= maxX; i ++){
            assignmentData[i] = Array(maxY+1);
            for (var j = 0; j <= maxY; j ++){
              var parent = document.getElementById (i+"-"+j);
              if (parent != null) {
                if (parent.getAttribute ("style") == "background-color: orange") {
                  assignmentData[i][j] = 1;
                } else {
                  assignmentData[i][j] = 0;
                }
              }
            }
          }

          $.ajax({
            url: contentURL,
            dataType: 'json',
            type: 'put',
            headers: { "Authorization": "Bearer " + globalToken },
            data: JSON.stringify (assignmentData),
            success: function(data) {
              if (data) {
              }
            }
          });
    return (false);
    }

    function downloadItem (){
          var createAddDir = msGraphApiRoot + "/drive/root/children";
          var appDataID = "";

          var createFolder = { 
            "name": settingDir,
            "folder": { },
            "@microsoft.graph.conflictBehavior": "fail" // if it doesn't work it exists so don't worry (famous last words)
          };

          $.ajax({
            url: createAddDir,
            dataType: 'json',
            contentType: 'application/json',
            type: 'post',
            async: false,
            headers: { "Authorization": "Bearer " + globalToken },
            accept: "application/json;odata.metadata=none",
            data: JSON.stringify (createFolder)
          });


          var contentURL = msGraphApiRoot + "/drive/root:" + fileName; 
          $.ajax({
            url: contentURL,
            dataType: 'json',
            headers: { "Authorization": "Bearer " + globalToken },
            accept: "application/json;odata.metadata=none",
            success: function(data) {
              if (data) {
                itemID = data['id'];
                $('#od-value').val (data['@microsoft.graph.downloadUrl']);
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                  var assignmentData = JSON.parse (xhttp.responseText);
                  for (var i = 0; i <= maxX; i ++){
                    for (var j = 0; j <= maxY; j ++){
                      var isChecked = assignmentData[i][j];
                      if (isChecked == 1){
                        clicked (i, j);
                      }
                    }
                  }
                document.getElementById("od-title").innerHTML = pageTitle;
                saved = 1;
                }
                };
                xhttp.open("GET", data['@microsoft.graph.downloadUrl'], true);
                xhttp.send();
              }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
              // creating the setting file since it doesn't exist
            var contentURL = msGraphApiRoot + "/drive/root:" + fileName + ":/content";
            $.ajax({
              url: contentURL,
              dataType: 'json',
              contentType: 'text/plain',
              type: 'put',
              async: false,
              data: "[]",
              headers: { "Authorization": "Bearer " + globalToken },
              accept: "application/json;odata.metadata=none",
              success: function (data){
                if (data){
                  itemID = data['id'];
                }
              }
            });
              uploadItem ();
            }
          });
    return (false);
    }

   function onAuthenticated(token, authWindow) {
      globalToken = token;
      if (token) {
        if (authWindow) {
          removeLoginButton();
          authWindow.close();
        }
        downloadItem ();
        window.setInterval(function(){ // check if we need to save the page every 5 seconds if we are logged in.
          if (saved == 0){
            uploadItem ();
            document.getElementById("od-title").innerHTML = pageTitle;
            saved = 1;
          }
        }, 5000);
      }
      else {
        alert("Error signing in");
      }
    }

    odauth();
  </script>

</BODY>
</HTML>
