<HTML>
<head>
  <title>CO4509 Assignment 1 - Grade estimator</title>
  <link rel="stylesheet" type="text/css" href="https://martinbateman.github.io/style.css"/>
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script id="odauth" src="https://martinbateman.github.io/odauth.js"></script>
  
  <link rel="icon" href="https://d.sfx-df.ms/images/favicon.ico" type="image/x-icon">
  <link rel="mask-icon" href="https://d.sfx-df.ms/images/mask_icon.svg" color="#094AB2">
<script>
  var moduleCode = "CO4509";
  var assignmentNumber = "1";
  var maxX = 0;
  var maxY = 0;
  var fileName = "/" + settingDir + "/" + moduleCode + "-assignment-" + assignmentNumber + ".json"; 
  var pageTitle = "CO4509 Assignment 1 - Grade estimator";
  </script>
</head>
<BODY>
 <div id="od-site">
    <div id="od-commands">
      <div id="od-login" style="display: hidden">
        <a href="#" onclick="signInToOneDrive()">Sign in to OneDrive</a>&nbsp;&nbsp;
      </div>
      <div id="od-logoff" style="display: hidden">
        <a href="#" onclick="signOut()">Sign Out</a>
      </div>
    </div>
    <div id="od-title">CO4509 Assignment 1 - Grade estimator</div>
  </div>

  <div id="od-loading"></div>
  <div id="od-breadcrumb"></div>
  <div id="od-content">
<P>
This allows you to estimate your mark based on which critria you have completed. You should note that you are
not guaranteed to get the mark you work out using this tool.
</P>
<p>
This page is experimental. There are probably bugs or at least weird things. If you find a bug or a weird thing could you let me know.
</p>
<TABLE BORDER=1>
<TR>
  <TD></TD>
  <td>Fail(30)</td>
  <td>Pass(50)</td>
  <td>Merit(60)</td>
  <td>Distinction(70)</td>
  <td>80(80)</td>

</TR>
<TR>
  <TD>Issues (50)<br> Description of key/value databases and memcrashed.</TD>
  
  <TD ID="0-0" onclick="javascript:clicked(0, 0)">Brief description, details are not clear or elements of the description are completely missing.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((50/100) * 30)/ 80 * 100;
var target = document.getElementById ("0-0");
target.setAttribute ("name", worth);
maxX = 0;
maxY = 0;
</script>

  
  <TD ID="1-0" onclick="javascript:clicked(1, 0)">Poor description of key/value databases.
Poor description of memcrashed.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((50/100) * 50)/ 80 * 100;
var target = document.getElementById ("1-0");
target.setAttribute ("name", worth);
maxX = 1;
maxY = 0;
</script>

  
  <TD ID="2-0" onclick="javascript:clicked(2, 0)">Good description of both key/value databases and memcrashed. Or an excellent description of one.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((50/100) * 60)/ 80 * 100;
var target = document.getElementById ("2-0");
target.setAttribute ("name", worth);
maxX = 2;
maxY = 0;
</script>

  
  <TD ID="3-0" onclick="javascript:clicked(3, 0)">Excellent description of both key/value databases and memcrashed.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((50/100) * 70)/ 80 * 100;
var target = document.getElementById ("3-0");
target.setAttribute ("name", worth);
maxX = 3;
maxY = 0;
</script>

  
  <TD ID="4-0" onclick="javascript:clicked(4, 0)">Excellent description of key/value databases and memcrashed. Include technical details (code) with an explanation of how the exploit is triggered.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((50/100) * 80)/ 80 * 100;
var target = document.getElementById ("4-0");
target.setAttribute ("name", worth);
maxX = 4;
maxY = 0;
</script>

  
</TR>
<TR>
  <TD>Prevention (20)<br> Description of how to prevent the issue in the future.</TD>
  
  <TD ID="0-1" onclick="javascript:clicked(0, 1)">Brief description.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((20/100) * 30)/ 80 * 100;
var target = document.getElementById ("0-1");
target.setAttribute ("name", worth);
maxX = 0;
maxY = 1;
</script>

  
  <TD ID="1-1" onclick="javascript:clicked(1, 1)">Poor description of how to prevent the issue. Obvious means or only looks at one aspect of prevention.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((20/100) * 50)/ 80 * 100;
var target = document.getElementById ("1-1");
target.setAttribute ("name", worth);
maxX = 1;
maxY = 1;
</script>

  
  <TD ID="2-1" onclick="javascript:clicked(2, 1)">Good description. When given to an export they could prevent the issue.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((20/100) * 60)/ 80 * 100;
var target = document.getElementById ("2-1");
target.setAttribute ("name", worth);
maxX = 2;
maxY = 1;
</script>

  
  <TD ID="3-1" onclick="javascript:clicked(3, 1)">Excellent description. Which when given to someone with technical knowledge would allow them to prevent the issue.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((20/100) * 70)/ 80 * 100;
var target = document.getElementById ("3-1");
target.setAttribute ("name", worth);
maxX = 3;
maxY = 1;
</script>

  
  <TD ID="4-1" onclick="javascript:clicked(4, 1)">Clear technical detailed including code/configuration that needs to changed.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((20/100) * 80)/ 80 * 100;
var target = document.getElementById ("4-1");
target.setAttribute ("name", worth);
maxX = 4;
maxY = 1;
</script>

  
</TR>
<TR>
  <TD>Predictions (20)<br> Predictions of the implications of this exploit.</TD>
  
  <TD ID="0-2" onclick="javascript:clicked(0, 2)">Short predictions which could be made by anyone, e.g. "it will become more important".</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((20/100) * 30)/ 80 * 100;
var target = document.getElementById ("0-2");
target.setAttribute ("name", worth);
maxX = 0;
maxY = 2;
</script>

  
  <TD ID="1-2" onclick="javascript:clicked(1, 2)">Predictions of future impact are poor but seemingly correct. May just be just opinion or back by citations (which may not fully back up the case).</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((20/100) * 50)/ 80 * 100;
var target = document.getElementById ("1-2");
target.setAttribute ("name", worth);
maxX = 1;
maxY = 2;
</script>

  
  <TD ID="2-2" onclick="javascript:clicked(2, 2)">Prediction of future impact are good but only backed up by opinion. Maybe few citations.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((20/100) * 60)/ 80 * 100;
var target = document.getElementById ("2-2");
target.setAttribute ("name", worth);
maxX = 2;
maxY = 2;
</script>

  
  <TD ID="3-2" onclick="javascript:clicked(3, 2)">Sensible predictions, backed by citations.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((20/100) * 70)/ 80 * 100;
var target = document.getElementById ("3-2");
target.setAttribute ("name", worth);
maxX = 3;
maxY = 2;
</script>

  
  <TD ID="4-2" onclick="javascript:clicked(4, 2)">Excellent predictions on future importance and effectiveness of cloud security security backed up by citations.

Case made uses current literature (less than a year old).</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((20/100) * 80)/ 80 * 100;
var target = document.getElementById ("4-2");
target.setAttribute ("name", worth);
maxX = 4;
maxY = 2;
</script>

  
</TR>
<TR>
  <TD>Presentation (10)<br> Writing quality</TD>
  
  <TD ID="0-3" onclick="javascript:clicked(0, 3)">Lots of spelling and grammatical mistakes. Difficulty in understanding what was meant in some cases.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((10/100) * 30)/ 80 * 100;
var target = document.getElementById ("0-3");
target.setAttribute ("name", worth);
maxX = 0;
maxY = 3;
</script>

  
  <TD ID="1-3" onclick="javascript:clicked(1, 3)">Some spelling and grammatical mistakes.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((10/100) * 50)/ 80 * 100;
var target = document.getElementById ("1-3");
target.setAttribute ("name", worth);
maxX = 1;
maxY = 3;
</script>

  
  <TD ID="2-3" onclick="javascript:clicked(2, 3)">Few spelling and grammatical mistakes. All diagrams are labelled and presented logically.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((10/100) * 60)/ 80 * 100;
var target = document.getElementById ("2-3");
target.setAttribute ("name", worth);
maxX = 2;
maxY = 3;
</script>

  
  <TD ID="3-3" onclick="javascript:clicked(3, 3)">Well written and grammatically correct.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((10/100) * 70)/ 80 * 100;
var target = document.getElementById ("3-3");
target.setAttribute ("name", worth);
maxX = 3;
maxY = 3;
</script>

  
  <TD ID="4-3" onclick="javascript:clicked(4, 3)">Publishable quality.</TD>

<script>
// it was easier to set this in JavaScript rather than set it via the HTML generator
// the name of the cell is its worth
var worth = ((10/100) * 80)/ 80 * 100;
var target = document.getElementById ("4-3");
target.setAttribute ("name", worth);
maxX = 4;
maxY = 3;
</script>

  
</TR>

</TABLE>
<BR/>
<div style="display: inline-block">Estimated Total: </div><div style="display: inline-block" id="total">0</div>

<script>

var total = 0;

function gradeMap (mark){

  var allowedGrades = [0, 10, 25, 35, 40, 45, 52, 55, 58, 62, 65, 68, 74, 81, 89, 96, 100];


  bestFit = 0;
  bestDistance = 100;
  for (i =0; i < allowedGrades.length; i ++) {
    var distance = Math.abs (mark - allowedGrades[i]);

    if (distance < bestDistance) {
      bestFit = i;
      bestDistance = distance;
    }
  }
  return (""+allowedGrades[bestFit]);
}

function clicked (cellIDX, cellIDY){

var x = 0;
var found = true;
// remove coloured backgrounds
while (found == true){
    var parent = document.getElementById (x+"-"+cellIDY);
    
    if (parent != null) {
      if (x != cellIDX) { // skip the cell that was clicked
                          // so we know if the user has deselected an option
        if (parent.getAttribute ("style") == "background-color: orange") {
          parent.setAttribute ("style", "background-color: white");
          total = total - Math.round(Number(parent.getAttribute ("name")));
        }
      }
    x = x +1;    
  } else {
    found = false;
  }
  if (globalToken != ""){
    saved = 0;
    document.getElementById("od-title").innerHTML = pageTitle + " (not saved)";
  }
}

// set/remove colour background
var parent = document.getElementById (cellIDX+"-"+cellIDY);
if (parent.getAttribute ("style") == "background-color: orange") {
  total = total - Math.round (Number(parent.getAttribute ("name")));
  parent.setAttribute ("style", "background-color: white");
} else {
  parent.setAttribute ("style", "background-color: orange");

  total = total + Math.round(Number(parent.getAttribute ("name")));
}
document.getElementById("total").innerHTML = gradeMap (total);
//total;
}

</script>


  </div>
  <script>
    var baseUrl = getQueryVariable("baseUrl")
    msGraphApiRoot = (baseUrl) ? baseUrl : "https://graph.microsoft.com/v1.0/me";

    var data = loadFromCookie();
    if (data)
    {
      if (!baseUrl)
        msGraphApiRoot = data.apiRoot;
      showCustomLoginButton(!data.signedin)
    }

    $(document).on({
      ajaxStart: function() {$('body').addClass('loading');},
      ajaxStop:  function() {$('body').removeClass('loading');}
    });

    function uploadItem (){
          var contentURL = msGraphApiRoot + "/drive/items/" + itemID + "/content";

          var assignmentData = Array(maxX+1);
          for (var i = 0; i <= maxX; i ++){
            assignmentData[i] = Array(maxY+1);
            for (var j = 0; j <= maxY; j ++){
              var parent = document.getElementById (i+"-"+j);
              if (parent != null) {
                if (parent.getAttribute ("style") == "background-color: orange") {
                  assignmentData[i][j] = 1;
                } else {
                  assignmentData[i][j] = 0;
                }
              }
            }
          }

          $.ajax({
            url: contentURL,
            dataType: 'json',
            type: 'put',
            headers: { "Authorization": "Bearer " + globalToken },
            data: JSON.stringify (assignmentData),
            success: function(data) {
              if (data) {
              }
            }
          });
    return (false);
    }

    function downloadItem (){
          var createAddDir = msGraphApiRoot + "/drive/root/children";
          var appDataID = "";

          var createFolder = { 
            "name": settingDir,
            "folder": { },
            "@microsoft.graph.conflictBehavior": "fail" // if it doesn't work it exists so don't worry (famous last words)
          };

          $.ajax({
            url: createAddDir,
            dataType: 'json',
            contentType: 'application/json',
            type: 'post',
            async: false,
            headers: { "Authorization": "Bearer " + globalToken },
            accept: "application/json;odata.metadata=none",
            data: JSON.stringify (createFolder)
          });


          var contentURL = msGraphApiRoot + "/drive/root:" + fileName; 
          $.ajax({
            url: contentURL,
            dataType: 'json',
            headers: { "Authorization": "Bearer " + globalToken },
            accept: "application/json;odata.metadata=none",
            success: function(data) {
              if (data) {
                itemID = data['id'];
                $('#od-value').val (data['@microsoft.graph.downloadUrl']);
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                  var assignmentData = JSON.parse (xhttp.responseText);
                  for (var i = 0; i <= maxX; i ++){
                    for (var j = 0; j <= maxY; j ++){
                      var isChecked = assignmentData[i][j];
                      if (isChecked == 1){
                        clicked (i, j);
                      }
                    }
                  }
                document.getElementById("od-title").innerHTML = pageTitle;
                saved = 1;
                }
                };
                xhttp.open("GET", data['@microsoft.graph.downloadUrl'], true);
                xhttp.send();
              }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
              // creating the setting file since it doesn't exist
            var contentURL = msGraphApiRoot + "/drive/root:" + fileName + ":/content";
            $.ajax({
              url: contentURL,
              dataType: 'json',
              contentType: 'text/plain',
              type: 'put',
              async: false,
              data: "[]",
              headers: { "Authorization": "Bearer " + globalToken },
              accept: "application/json;odata.metadata=none",
              success: function (data){
                if (data){
                  itemID = data['id'];
                }
              }
            });
              uploadItem ();
            }
          });
    return (false);
    }

   function onAuthenticated(token, authWindow) {
      globalToken = token;
      if (token) {
        if (authWindow) {
          removeLoginButton();
          authWindow.close();
        }
        downloadItem ();
        window.setInterval(function(){ // check if we need to save the page every 5 seconds if we are logged in.
          if (saved == 0){
            uploadItem ();
            document.getElementById("od-title").innerHTML = pageTitle;
            saved = 1;
          }
        }, 5000);
      }
      else {
        alert("Error signing in");
      }
    }

    odauth();
  </script>

</BODY>
</HTML>
